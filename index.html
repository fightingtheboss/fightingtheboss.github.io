<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Scaling Meteor by fightingtheboss</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Scaling Meteor</h1>
        <p>My experiences scaling up Pegleg (pegleg.it), a Meteor project, beyond a single instance</p>


        <p class="view"><a href="https://github.com/fightingtheboss">View My GitHub Profile</a></p>

      </header>
      <section>
        <h3>It's Good To Have Goals</h3>

<p>I had three main objectives when scaling Pegleg to multiple instances:</p>

<ol>
<li>Site handles the load and works correctly</li>
<li>Simple deployment</li>
<li>Low cost</li>
</ol><p>I used these three criteria to evaluate the suitability of each solution for my purposes. Because of a lack of tools and time, I didn't load test any of these scenarios scientifically, so the decision on criteria 1 was made anecdotally (suitable enough for a small side-project like Pegleg). I'll circle back to load testing near the end.</p>

<h3>Back to the Future (aka TL;DR)</h3>

<p>Going from zero to hero took a few iterations (and a lot of research and trial-and-error). I ended up with three different deployment strategies for scaling Meteor:</p>

<ol>
<li>Manual deployment to AWS</li>
<li>AWS Elastic Beanstalk deployment</li>
<li>Custom deployment on private VPS</li>
</ol><p>After running on the manual AWS setup for a month, I ultimately ended up going with the private VPS option for simplicity and cost reasons that I'll get into below.</p>

<h3>Understanding The Problem</h3>

<p>The free hosting provided by Meteor at meteor.com is great for deploying prototypes and toys but if your traffic starts to ramp up, you'll eventually have to move on to your own infrastructure. Given that deploying to meteor.com is basically a black box, there's some background information you need to deploy a Meteor app to your own stack:</p>

<ul>
<li>Node

<ul>
<li>Compatible version</li>
<li>Memory footprint</li>
</ul>
</li>
<li>MongoDB

<ul>
<li>Backing up your data</li>
<li>Hosting your data</li>
</ul>
</li>
<li>Meteor (and Meteorite)

<ul>
<li>Building your app</li>
<li>Bundles</li>
</ul>
</li>
<li>Load Balancing &amp; Session Affinity</li>
</ul><h2>Background</h2>

<h3>Beginnings</h3>

<p>I built <a href="http://pegleg.it">Pegleg</a> back in January as a side-project to learn Meteor and to help friends and film-buffs find full-length movies on YouTube by working together. Initially I was using the generously provided and dead simple free meteor.com hosting, which is the perfect platform for getting your Meteor prototypes some real-world users on the web. With a few blog posts about it and word of mouth, it slowly gained a bit of popularity.</p>

<h3>Blow-Up</h3>

<p>After being up and slowly improved for about six or eight weeks, the link to Pegleg was posted on Hacker News on a Friday morning and made it to the home page. After an initial bout of euphoria about having hit on the holy grail of an HN home page mention, I was quickly hit with the reality of what that means. The free hosting provided by Meteor wasn't designed to handle that kind of load and the site slowed to an unusable crawl.</p>

<h3>Short-Circuit</h3>

<p>After trying to resolve things with the gracious and patient help of Kara and David at Meteor one thing became certain: I needed to scale off of the Meteor free hosting to meet the needs of the new influx of users. This was easier said than done because there wasn't much in the way of documentation on that front. David pointed me to <a href="http://www.ripariandata.com/blog/creating-an-aws-elastic-load-balancer">this blog post about load balancing on AWS</a> to get me started and that's where we'll begin this journey.</p>

<h3>Batteries Not Included</h3>

<p>As a caveat, I'm certainly not a sys-ops master, and I often find jockeying servers and worrying about deployments to be a tedious necessary evil to get my sites online. This situation forced me to learn a bunch of the stuff I'd been wilfully ignoring for as long as I could. If you are great at this stuff I'd love to hear feedback on better ways to approach this.</p>
      </section>
      <footer>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>